name: ci
on: [push]
jobs:
  ci:
    name: ${{ matrix.name }}
    runs-on: ${{ matrix.os }}
    strategy:
      fail-fast: false
      matrix:
        name: [macos, ubuntu, windows]
        include:
          - name: macos
            os: macos-latest
            compiler: gcc
            version: "9"
            vcpkg_triplet: x64-osx
          - name: ubuntu
            os: ubuntu-latest
            vcpkg_triplet: x64-linux
          - name: windows
            os: windows-latest
            vcpkg_triplet: x64-windows-static
    steps:
        uses: actions/checkout@v2
        with:
          path: libmw
      - name: setup macos environment
        if: runner.os == 'macOS'
        run: |
          brew install gcc cmake
          echo "::set-env name=CC::gcc-${{ matrix.version }}"
          echo "::set-env name=CXX::g++-${{ matrix.version }}"
      - name: setup ubuntu environment
        if: runner.os == 'Linux'
        run: sudo apt install uuid-dev
      - name: Checkout vcpkg
        uses: actions/checkout@v2
        with:
          repository: microsoft/vcpkg
          path: vcpkg
          ref: '2020.06'
      - name: Run vcpkg
        uses: lukka/run-vcpkg@v3
        with:
          vcpkgArguments: '--triplet ${{ matrix.vcpkg_triplet }} @${{ github.workspace }}/libmw/vcpkg/packages.txt'
          vcpkgDirectory: '${{ github.workspace }}/vcpkg'
          vcpkgGitCommitId: '6185aa76504a5025f36754324abf307cc776f3da'
      - name: make build directory
        run: |
            cd ${{ github.workspace }}/libmw && mkdir build && cd build
            cmake -DCMAKE_TOOLCHAIN_FILE=${{ github.workspace }}/vcpkg/scripts/buildsystems/vcpkg.cmake -DVCPKG_TARGET_TRIPLET=${{ matrix.vcpkg_triplet }} -DCMAKE_BUILD_TYPE=Release ..
            cmake --build . --config Release